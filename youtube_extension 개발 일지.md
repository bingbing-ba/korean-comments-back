# youtube extension 개발 일지

## ~9.1

- chrome extension 제작
  - 처음 생각
    - 현재 페이지에서 댓글 중에 한글이 아닌 댓글을 모두 날려버림
  - 문제점
    - 해봤는데 한글 댓글이 적을 경우 원하는 양의 한글 댓글을 찾을 때까지의 로딩이 너무 오래 걸림
  - 고친 생각
    - youtube data api를 사용해서 댓글을 서버에서 조회하고, extension에서는 데이터만 전달 받아 댓글과 비슷하게 렌더링함
  - 문제점
    - 직접 댓글 컴포넌트를 만들어야 됨
    - 원래 댓글 컴포넌트에 달려있던 기능 사용 못함
  - 메모
    - `chrome.browserAction.onClicked` 를 통해서 익스텐션 눌렀을 때 작동되도록 함.
    - `chrome.tabs.executeScript` 를 통해 js 파일 실행
      - 실행할 js 파일 manifest에 등록해야 하는 줄 알았는데, 그럴 필요 없었음.
      - `content_scripts` 부분 추가 해야되는 줄 알고 추가 했는데, 추가하면 페이지 로드되자 마자 등록한 js 파일도 로드되어 실행되어버림, 원하는 것 아니었음. 알고 뺌
    - 들어갈 컴포넌트를 처음에는 youtube에 있는 컴포넌트를 그대로 복사해서 사용하려 하니까 바닐라 js로는 어림도 없음, 그래서 react를 활용하기로 마음 먹음. 그런데 cra는 내가 원하는대로 만들어 지지 않아서 직접 webpack 설정을 해보기로 마음먹음
    - 결국 webpack이란게 여러 파일을 하나 혹은 원하는 수의 파일로 압축해주는 것. 웹팩 설정할 때는 html이 보통 결과로 포함 되는데, 내가 만들 앱에선 전혀 필요없어서 빼고 설정하는 법도 알게 되었고, 원하는 js파일을 포함하는 것, json파일을 포함하는 법도 알게 되었다. 여러 플러그인과 웹팩 공식문서가 잘 되어있어서 잘 읽어보니 쉽게 적용 가능했다.
    - 현재 댓글을 전부 날리고 리로딩을 맡고 있는 컴포넌트 까지 날리는 데 성공
    - react로 youtube data api가 주는 데이터(아직은 서버없어서 그냥 json 활용)를 토대로 댓글 컴포넌트 비슷하게 만들어서 원하는 위치에 추가하는 것 성공.

## 9.2

- 최근에 이용했던 firebase functions를 활용하기로 함
- database 사용해서 로컬환경에서 CR 테스트 해봄
- youtube api 쓰려는데 googlesapis라는 npm 모듈이 있길래 사용해보는 중
- 구글 디벨로퍼콘솔에서 프로젝트 만들고 해당 api용 키 생성해서 적용

- api를 분리하는 게 좋겠지?
  - 단순히 조회만 하는 api
  - 한글 코멘트 리스트를 업데이트하는 api
    - 한글이 없을 수 있으니까.. 댓글 1000개 봤는데 한글이 없으면 한글 없는 애로 구별 필요할 듯?
    - 그렇다고 만약에 댓글이 10만개 있는데 원하는 한글 댓글 수 다 찾을 때까지 다 돌려 볼 수는 없잖아.. 맥시멈 댓글을 1만개까지만 보도록?...할까 어쩔까
    - 한글 댓글 수가 100개가 되면 일단 찾는 작업 끝내고, 추가 작업이 필요할 지는 나중에 판단하자.
  - 데이터에 업데이트 일자를 넣도록 작업하고, 데이터를 가져왔는데 업데이트 일자가 일주일 이상이면 업데이트 api를 콜해주는거를 프론트에서 작업.

- 테스트 결과 ㅏ-ㅣ 테스트에서 빼기로 함 애들이 특수문자로 사용함
- 댓글이 100만개 있더라도 그 중에 한글 댓글만 뽑아 주는게 이 앱이 할 일인 것 같다는 생각
  - 그런데 이 경우 요청 10개 보내고 받는데도 10초 정도 걸림
  - 백만개 있으면 요청 만개 보내야되고, 영상 하나에 바로 하루 할당량 채워버림. 시간도 만초면 3600초가 한시간이니까 3시간정도... 이거는 아닌듯
  - 하루 요청 맥시멈 만개라고 하고, 백명 이용하면 한사람당 요청 100개, 댓글 만개 살펴보면 충분하지 않을까?
  - updatedAt은 있는데, items는 없다면: 댓글 만개를 찾아 보았는데, 한글 댓글이 없습니다.
  - 정렬 기준을 따로 해보는 것도 나중에

## 9.3

- 한글 테스트를 위해서 `/[ㄱ-ㅎ|가-힣]/` 을 썼는데, 검색결과에 `|` (파이프 문자)가 포함되었다. 정규표현식으로는 답을 모르겠어서 `/[ㄱ-ㅎ]/` `/[가-힣]/` 두 개로 나누어 진행하고 js 에서 or 연산을 했다.
- 파베 요청응답 타임아웃이 있어서, 늘리는 설정해줌
- 어제 api요청에 뭔가 문제가 있었는지, 1분안에 거의 요청응답 되는듯?
- 댓글은 충분히 있는데, nextpagetoken을 통해 계속 요청을 갱신하다보면 어느샌가 결과가 안나온다, 200인데, 무슨이유로?.. order가 relevance이면 1700개까지 밖에 준비 안하나?
  - order 때문에 18번까지만 요청, 최신순으로 하면 100번 다 찾음
  - 대충 100번 요청했을 때 1분 가량 소요되는 것으로 파악
- 애들 번역기 돌린거를 보고싶어할까?
  - 번역기 돌린 지 아닌지를 어떻게 파악할까? - api써서 할 수 있겠지만 언제 다 파악할까?..
- 일단 백엔드 완성

## 9.4

- `ReferenceError: regeneratorRuntime is not defined` 와 같은 에러가 떠서 확인해보니 `async` `await` 관련 이슈다. polyfill을 염두에 두고 웹팩과 바벨이 작업을 하기 때문에 발생한 문제인데, 관련 로더를 설정해 주면 된다. 나의 경우는 어차피 크롬익스텐션이니까 `async` `await`을 번역하지 않도록 바벨 세팅을 해주었다.

  ```json
  {
    "presets": [
        ["@babel/env", {
          "targets": {"chrome": "55"},
          "debug": true
        }],
        "@babel/react"
    ]
  }
  ```

- react 에서 axios로 데이터를 요청했는데, 정상적으로 요청이 가지만 data가 빈 문자열이 되는 문제 발생

  - 걍 cra에서 테스트 해봤는데 잘됨..
  - 콘솔 자세히 보니 CORB 문제 발생
  - 갑자기 되긴 하는데... 왜 되는지 도통 이유 알수없음
  - corb는 cross origin read blocking의 약자. 크로미움 문서 읽어보니까 신뢰할 수 없는 data를 읽어오는 것을 막기위한 보안정책의 일환인듯
  - 또 안됨 돌아버릴듯

## 9.6

- 안되는게 뭔가 youtube의 정책 때문이라는 느낌이 들고 있음

  - 단지 데이터를 가져와서 console에 띄우기만 하면 잘 됨
  - 그런데 페이지에 해당 데이터를 통해 조작하려하면 문제가 발생
  - 그래서 놨다가, 갑자기 그냥 팝업페이지에다가 댓글 표시해주면 어떨까 싶어짐 - 성공, 오히려 더 깔끔한 듯

- popup으로 오면서 webpack dev server로 개발하는게 나아서 갈아타게되었다.

  - build 해서 popup에서 보게 되면 react관련 에러를 정확히 표시하지 않는다. minified되었기 때문에 그렇다고 콘솔에 표시된다.

- fontawesome에서 로딩 컴포넌트 하나 쓰려니까 에러가 발생한다

  - ![image-20200907004545870](youtube_extension 개발 일지.assets/image-20200907004545870.png)

  - `import '@fortawesome/fontawesome-free/js/all'` 이걸로 컴포넌트를 쓸 때 발생하는 에러인데, 아마 내부적으로 querySelector를 통해 컴포넌트를 삭제하는 코드가 있는 듯하다. 관련해서 에러가 발생한다는 블로그 포스팅을 보았다.
  - react용 fontawesome을 받아 써봐야겠다.
  - css를 import해서 쓰려니까 webpack 설정할 게 또 많아서(css에 딸려있는 다양한 확장자의 파일들때문에..) 그냥 react용 받아서 써보기로

## 9.7

- Spinner를 따로 컴포넌트로 빼면서 resolver의 alias를 쓰다보니 자동완성이 되지 않는 것이 불편했다. 어찌어찌 검색해서 찾았는데, 생각해보니 해당 기능은 vscode가 지원해야 하는 기능이었으므로 vscode 키워드를 붙여 검색했다면 훨씬 빨리 찾았을 듯.

  - 어쨌든` jsconfig.json` 이라는 설정파일을 통해 해결할 수 있었다. vscode refference에도 잘 나와있다. 블로그보고 따라썼다가 안돼서 공문보고 수정(맨 아래 `*` 부분)

    ```json
    {
      "compilerOptions": {
        "baseUrl": ".",
        "paths": {
          "@/*":["./src/*"]
        }
      }
    }
    ```

- modal을 직접 만들면서
  - scroll-lock: 바깥 컨테이너는 `max-height` 고정, `overflow: hidden`, 모달 컨테이너는 `overflow-y: scroll`
  - 적용했는데도 스크롤바가 있다면: 바깥 컨테이너가 고정 width, height를 가지고 있진 않은지 체크
  - 결국 그냥 react-modal 씀
- 다른 써드파티 컴포넌트 쓰는데, 쓰면 커스터마이징이 애먹고, 안쓰자니 하나 하나 만들기 너무 귀찮고...스타일링 하느라 하루 다갔다

## 9.8

- 요금이 발생하기 시작했다. 개발중인데도. 쓰고 받는 데이터가 많아서 요금이 발생하는 듯한데, 프론트 개발할 때 받아놓은 json데이터를 버리지 말 걸 그랬다.
- js 숫자 humanize를 직접 만들었다.
- 자세히 보기 간략히 보기를 엘리먼트의 높이를 기준으로 작성하려한다. overflow를 숨기고 버튼 눌러서 하면 될듯하다.
- 링크는 안될 것 같고, 이쁘게 보이게만, 그리고 새탭 열기로 되는지?

## 9.10

- a태그 새탭열기로 하는거 useEffect에다가 querySelector써서 해버렸다.
- 닫았다 열면 새로 페이지가 요청되는 게 아무래도 좀 그렇다. 사용자가 많아지면 개선하는 걸로
- 내일 배포하고, 홍보를 어디다가 해야될까

## 9.11

- 배포하는데 생긴일

  - 128x128 아이콘이 필요해서 추가로 만들었다.

  - 스토어 개발자 계정은 이전에 만들어 놓았는데, 등록하려니까 이메일 등록된 거 없다고 해서 계정에서 등록했다.

  - ![image-20200911152435294](youtube_extension 개발 일지.assets/image-20200911152435294.png)

    맨위의 패키지 정보와 스토어 등록정보 뿐만아니라 개인정보 보호 까지 작성해야 배포할 수 있다. 임시 저장할 때 뜨는 경고로 뭘 채워넣어야 하는지 알 수 있다.

  - 지금 `permissions`탭의 youtube url 적어넣은 게 필요없을 수도 있단 걸 알고 확인 중이다. 일단 없어도 앱은 잘 돌아간다. 그렇다면 저 host 권한은 어떨 때 쓰는걸까? 

    - 해당 페이지의 코드와 인터렉션이 필요할 때 쓴다는 stack overflow 답변이 있었다.

  - 모든 항목을 채워넣어 제출을 완료했다! 기쁘다

## 9.13

- 배포한 익스텐션이 공개처리 되었다. 생각보다 빠르다
- 마켓에 검색해보니 내 앱이 검색 되질 않는다. why?.. 근데 흥미롭게도 비슷한 기능을 하지만 원래 내가 하려고 했던 방식의 구현을 해 놓은 앱이 있었다ㅎㅎ..
  - 더 보기를 하니까 내 앱도 검색이 된다. 우선순위가 아직 높지 않아서 검색이 안 되는 듯!
- 아마 개발전에 봤다면 나는 개발을 포기했을 텐데, 개발을 하면서 배운 게 많은 지금, 검색해보지 않길 오히려 잘했다는 생각도 든다. 그렇기 때문에 지금 있는 앱과는 또 다른 차별성도 존재한다.
- 그런데 [youtube comment language filter](https://chrome.google.com/webstore/detail/youtube-comment-language/pliobnchkbenbollnjaaojhbjkjgfkni?hl=ko) 는 어떻게 구현한 건지 궁금해서 [github](https://github.com/anaclumos/youtube-comment-language-filter)을 찾아 놓았다. 내부 코드에 어떻게 접근한건지 코드를 훑어보고, 이해가 안가면 메일을 보내서 질문해봐야겠다.
  - 개발자 블로그에 개발기가 있었고, 나와 비슷한 고민을 했던 흔적을 볼 수 있었다.
  - minified된 내부 코드에 접근한게 아니라, 그냥 나와 같이 처음에는 html 태그를 보고 내부 언어를 필터링 했던 것.
  - 그런데 나는 애초에 필터링 대상 영상들이 블랙핑크, bts 등 외국인 댓글이 압도적으로 많은 영상들이었고, youtube 페이지에서 해당 방식의 로딩은 한 번에 20개의 댓글을 그 것도 내 기준 아주 느린속도로 불러오기 때문에 포기 했던 것
  - 웹 페이지 내부에 내가 만든 comments 를 삽입하려 했으나 corb 이슈에 부딪혔고, popup에 표시하는 형태의 웹페이지가 되었다.